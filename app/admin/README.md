# API Документация Административной Панели

## Базовый URL
```
/admin
```

## Аутентификация

Все эндпоинты требуют аутентификации через `tg_id` (Telegram user ID).

**Для работы в Telegram Mini App:**
- Передавайте `tg_id` как query параметр во всех запросах
- Пользователь должен иметь права администратора (`is_admin = true`)
- Пользователь должен быть активен (`is_active = true`)

**Пример запроса:**
```
GET /admin/users?tg_id=123456789&skip=0&limit=100
```

**Проверка прав:**
- Обычные администраторы имеют доступ к управлению пользователями, транзакциям и статистике
- Суперадмины (`is_super_admin = true`) имеют дополнительный доступ к управлению администраторами

---

## Эндпоинты Управления Пользователями

### GET /admin/users
**Описание:** Получить список всех пользователей

**Права доступа:** Администратор

**Query параметры:**

| Параметр      | Тип    | Описание           | Обязательный |
|---------------|--------|--------------------|--------------|
| tg_id         | int    | Telegram user ID   | Да           |
| skip          | int    | Пропустить N записей| Нет          |
| limit         | int    | Лимит записей      | Нет          |
| is_admin      | bool   | Фильтр по админам  | Нет          |
| is_active     | bool   | Фильтр активности  | Нет          |
| is_super_admin| bool   | Фильтр суперадминов| Нет          |

**Выходные данные:**
```json
[{
  "id": 0,
  "tg_id": 0,
  "username": "string",
  "name": "string",
  "balance": 0.0,
  "is_admin": false,
  "is_super_admin": false,
  "is_active": true,
  "created_at": "2025-01-27T00:00:00",
  "login": "string"
}]
```

---

### GET /admin/users/{user_id}
**Описание:** Получить информацию о пользователе

**Права доступа:** Администратор

**URL параметры:**

| Параметр | Тип | Описание |
|----------|-----|----------|
| user_id  | int | ID пользователя |

**Query параметры:**

| Параметр | Тип | Описание           | Обязательный |
|----------|-----|--------------------|--------------|
| tg_id    | int | Telegram user ID   | Да           |

**Выходные данные:** См. выше (один объект)

---

### POST /admin/users/{user_id}/ban
**Описание:** Забанить пользователя

**Права доступа:** Администратор

**URL параметры:**

| Параметр | Тип | Описание |
|----------|-----|----------|
| user_id  | int | ID пользователя |

**Query параметры:**

| Параметр | Тип | Описание           | Обязательный |
|----------|-----|--------------------|--------------|
| tg_id    | int | Telegram user ID   | Да           |

**Выходные данные:** Объект пользователя с `is_active = false`

---

### POST /admin/users/{user_id}/unban
**Описание:** Разбанить пользователя

**Права доступа:** Администратор

**URL параметры:**

| Параметр | Тип | Описание |
|----------|-----|----------|
| user_id  | int | ID пользователя |

**Query параметры:**

| Параметр | Тип | Описание           | Обязательный |
|----------|-----|--------------------|--------------|
| tg_id    | int | Telegram user ID   | Да           |

**Выходные данные:** Объект пользователя с `is_active = true`

---

### PATCH /admin/users/{user_id}
**Описание:** Изменить данные пользователя

**Права доступа:** Администратор

**URL параметры:**

| Параметр | Тип | Описание |
|----------|-----|----------|
| user_id  | int | ID пользователя |

**Query параметры:**

| Параметр | Тип | Описание           | Обязательный |
|----------|-----|--------------------|--------------|
| tg_id    | int | Telegram user ID   | Да           |

**Входные параметры (Body, JSON):**
```json
{
  "name": "string",
  "username": "string",
  "tg_id": 0,
  "balance": 0.0,
  "is_admin": false,
  "is_super_admin": false,
  "is_active": true
}
```
*Все поля опциональны*

**Выходные данные:** Обновленный объект пользователя

---

## Эндпоинты Управления Администраторами

### POST /admin/admins
**Описание:** Создать администратора

**Права доступа:** Суперадмин

**Query параметры:**

| Параметр | Тип | Описание           | Обязательный |
|----------|-----|--------------------|--------------|
| tg_id    | int | Telegram user ID   | Да           |

**Входные параметры (Body, JSON):**
```json
{
  "login": "string",
  "password": "string",
  "name": "string",
  "username": "string",
  "is_super_admin": false
}
```

**Выходные данные:**
```json
{
  "id": 0,
  "tg_id": 0,
  "username": "string",
  "name": "string",
  "login": "string",
  "is_admin": true,
  "is_super_admin": false,
  "is_active": true,
  "created_at": "2025-01-27T00:00:00"
}
```

---

### GET /admin/admins
**Описание:** Получить список всех администраторов

**Права доступа:** Суперадмин

**Query параметры:**

| Параметр | Тип | Описание           | Обязательный |
|----------|-----|--------------------|--------------|
| tg_id    | int | Telegram user ID   | Да           |

**Выходные данные:** Массив объектов администраторов

---

### DELETE /admin/admins/{admin_id}
**Описание:** Удалить администратора

**Права доступа:** Суперадмин

**URL параметры:**

| Параметр | Тип | Описание |
|----------|-----|----------|
| admin_id | int | ID администратора |

**Query параметры:**

| Параметр | Тип | Описание           | Обязательный |
|----------|-----|--------------------|--------------|
| tg_id    | int | Telegram user ID   | Да           |

**Выходные данные:**
```json
{
  "message": "Администратор успешно удален"
}
```

---

### PATCH /admin/admins/{admin_id}/permissions
**Описание:** Изменить права администратора

**Права доступа:** Суперадмин

**URL параметры:**

| Параметр | Тип | Описание |
|----------|-----|----------|
| admin_id | int | ID администратора |

**Query параметры:**

| Параметр | Тип | Описание           | Обязательный |
|----------|-----|--------------------|--------------|
| tg_id    | int | Telegram user ID   | Да           |

**Входные параметры (Body, JSON):**
```json
{
  "is_super_admin": true
}
```

**Выходные данные:** Обновленный объект администратора

---

## Эндпоинты Транзакций

### GET /admin/transactions
**Описание:** Получить список транзакций

**Права доступа:** Администратор

**Query параметры:**

| Параметр | Тип    | Описание              | Обязательный |
|----------|--------|-----------------------|--------------|
| tg_id    | int    | Telegram user ID      | Да           |
| skip     | int    | Пропустить N записей  | Нет          |
| limit    | int    | Лимит записей         | Нет          |
| type     | string | Фильтр по типу        | Нет          |
| status   | string | Фильтр по статусу     | Нет          |

**Типы:** `deposit`, `withdraw`, `referral_reward`, `payout`, `loss`, `admin_adjust`  
**Статусы:** `pending`, `posted`, `failed`, `reversed`

**Выходные данные:**
```json
[{
  "id": 0,
  "user_id": 0,
  "type": "deposit",
  "amount": 100.0,
  "status": "posted",
  "merchant_order_id": "string",
  "plat_guid": "string",
  "plat_withdraw_id": "string",
  "created_at": "2025-01-27T00:00:00"
}]
```

---

### GET /admin/transactions/{transaction_id}
**Описание:** Получить информацию о транзакции

**Права доступа:** Администратор

**URL параметры:**

| Параметр      | Тип | Описание |
|---------------|-----|----------|
| transaction_id| int | ID транзакции |

**Query параметры:**

| Параметр | Тип | Описание           | Обязательный |
|----------|-----|--------------------|--------------|
| tg_id    | int | Telegram user ID   | Да           |

**Выходные данные:** Объект транзакции (см. выше)

---

## Эндпоинт Статистики

### GET /admin/statistics
**Описание:** Получить статистику платформы

**Права доступа:** Администратор

**Query параметры:**

| Параметр | Тип | Описание           | Обязательный |
|----------|-----|--------------------|--------------|
| tg_id    | int | Telegram user ID   | Да           |

**Выходные данные:**
```json
{
  "total_users": 150,
  "online_users": 23,
  "total_balance": 50000.0,
  "total_deposits": 100000.0,
  "deposits_count": 500,
  "total_withdrawals": 45000.0,
  "withdrawals_count": 300,
  "net_profit": 55000.0
}
```

---

## Статус коды

| Код | Описание |
|-----|----------|
| 200 | OK |
| 201 | Created |
| 400 | Bad Request |
| 401 | Unauthorized |
| 403 | Forbidden |
| 404 | Not Found |
| 409 | Conflict |
| 500 | Internal Server Error |
