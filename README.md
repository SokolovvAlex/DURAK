# üÉè Burkozel

–ú—É–ª—å—Ç–∏–ø–ª–µ–µ—Ä–Ω–∞—è –æ–Ω–ª–∞–π–Ω-–∏–≥—Ä–∞ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º **FastAPI**, **Redis**, **PostgreSQL** –∏ **Centrifugo** –¥–ª—è real-time –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è.

---

## üöÄ –ó–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ Docker

### 1. –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
–°–æ–∑–¥–∞—Ç—å —Ñ–∞–π–ª `.env` –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞:

```env
BOT_TOKEN=test_token
ADMIN_IDS=[5254325840]
BASE_URL=base_url
FRONT_URL=base_url

SECRET_KEY=bbe7d157-a253-4094-9759-06a8236543f9

# Redis
REDIS_HOST=localhost
REDIS_PORT=6379
REDIS_PASSWORD=my_super_pass
REDIS_SSL=0


CENTRIFUGO_API_KEY=super_api_key
CENTRIFUGO_URL=http://localhost:8000/api
SOCKET_URL=ws://localhost:8000/connection/websocket


# POSTGRES
POSTGRES_DB=durak
POSTGRES_USER=postgres
POSTGRES_PASSWORD=postgres
POSTGRES_PORT=5432
POSTGRES_HOST=localhost

PLAT_SHOP_ID=888
PLAT_SECRET_KEY=11

```

### 2. –°–±–æ—Ä–∫–∞ –∏ –∑–∞–ø—É—Å–∫

```commandline
docker-compose up --build
```


### 3. –î–æ—Å—Ç—É–ø
API ‚Üí http://localhost:8000

Swagger Docs ‚Üí http://localhost:8000/docs

### üìÇ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞
bash
```commandline
app/
 ‚îú‚îÄ‚îÄ game/          # –∏–≥—Ä–æ–≤–∞—è –ª–æ–≥–∏–∫–∞
 ‚îÇ   ‚îú‚îÄ‚îÄ api/       # —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã
 ‚îÇ   ‚îú‚îÄ‚îÄ core/      # –ø—Ä–∞–≤–∏–ª–∞ –∏–≥—Ä—ã (Burkozel)
 ‚îÇ   ‚îú‚îÄ‚îÄ redis_dao/ # —Ä–∞–±–æ—Ç–∞ —Å Redis
 ‚îÇ   ‚îî‚îÄ‚îÄ tests/     # —Ç–µ—Å—Ç—ã
 ‚îú‚îÄ‚îÄ users/         # –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
 ‚îú‚îÄ‚îÄ payments/      # —Å–∏—Å—Ç–µ–º–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
 ‚îú‚îÄ‚îÄ migration/     # alembic –º–∏–≥—Ä–∞—Ü–∏–∏
 ‚îú‚îÄ‚îÄ config.py      # –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
 ‚îî‚îÄ‚îÄ main.py        # —Ç–æ—á–∫–∞ –≤—Ö–æ–¥–∞ FastAPI
```

### üéÆ –≠–Ω–¥–ø–æ–∏–Ω—Ç—ã

---

#### üïπ –ò–≥—Ä—ã (`/games`)
| –ú–µ—Ç–æ–¥ | –≠–Ω–¥–ø–æ–∏–Ω—Ç              | –û–ø–∏—Å–∞–Ω–∏–µ                                           |
|-------|-----------------------|---------------------------------------------------|
| GET   | `/games/`             | –ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ –∏–≥—Ä—ã                                 |
| GET   | `/games/{game_id}`    | –ü–æ–ª—É—á–∏—Ç—å –∏–≥—Ä—É –ø–æ ID                               |
| POST  | `/games/clear_db`     | –û—á–∏—Å—Ç–∏—Ç—å –ë–î (–∫—Ä–æ–º–µ —Ç–∞–±–ª–∏—Ü—ã `game_types`)          |

---

#### üé¥ –ë—É—Ä–∫–æ–∑–µ–ª (`/burkozel`)
| –ú–µ—Ç–æ–¥ | –≠–Ω–¥–ø–æ–∏–Ω—Ç                          | –û–ø–∏—Å–∞–Ω–∏–µ                          |
|-------|-----------------------------------|-----------------------------------|
| POST  | `/burkozel/find_player`           | –ù–∞–π—Ç–∏ –∏–ª–∏ —Å–æ–∑–¥–∞—Ç—å –∫–æ–º–Ω–∞—Ç—É         |
| POST  | `/burkozel/join_room`             | –ü—Ä–∏—Å–æ–µ–¥–∏–Ω–∏—Ç—å—Å—è –∫ –∫–æ–º–Ω–∞—Ç–µ          |
| POST  | `/burkozel/ready`                 | –û—Ç–º–µ—Ç–∏—Ç—å –∏–≥—Ä–æ–∫–∞ –≥–æ—Ç–æ–≤—ã–º           |
| POST  | `/burkozel/move`                  | –°–¥–µ–ª–∞—Ç—å —Ö–æ–¥ (–∞—Ç–∞–∫–∞/–∑–∞—â–∏—Ç–∞)        |
| POST  | `/burkozel/leave`                 | –í—ã–π—Ç–∏ –∏–∑ –∫–æ–º–Ω–∞—Ç—ã                  |
| GET   | `/burkozel/rooms`                 | –°–ø–∏—Å–æ–∫ –æ–∂–∏–¥–∞—é—â–∏—Ö –∫–æ–º–Ω–∞—Ç           |
| GET   | `/burkozel/all_rooms`             | –í—Å–µ –∫–æ–º–Ω–∞—Ç—ã                       |
| GET   | `/burkozel/room/{room_id}`        | –°–æ—Å—Ç–æ—è–Ω–∏–µ –∫–æ–º–Ω–∞—Ç—ã                 |
| POST  | `/burkozel/clear_room/{room_id}`  | –û—á–∏—Å—Ç–∏—Ç—å –∫–æ–º–Ω–∞—Ç—É                  |
| POST  | `/burkozel/clear_redis`           | –û—á–∏—Å—Ç–∏—Ç—å Redis                    |
| POST  | `/burkozel/create_test_room`      | –°–æ–∑–¥–∞—Ç—å —Ç–µ—Å—Ç–æ–≤—É—é –∫–æ–º–Ω–∞—Ç—É          |
| POST  | `/burkozel/create_last_hand_room` | –¢–µ—Å—Ç –∫–æ–Ω—Ü–∞ –∏–≥—Ä—ã                   |

---

#### üë§ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ (`/users`)
| –ú–µ—Ç–æ–¥ | –≠–Ω–¥–ø–æ–∏–Ω—Ç                                | –û–ø–∏—Å–∞–Ω–∏–µ                          |
|-------|-----------------------------------------|-----------------------------------|
| POST  | `/users/add_user`                       | –°–æ–∑–¥–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è              |
| GET   | `/users/all_users`                      | –°–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π              |
| GET   | `/users/get_current_user?tg_id=...`     | –ü–æ–ª—É—á–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ `tg_id`  |
| PATCH | `/users/update_user/{user_id}`          | –û–±–Ω–æ–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è      |

---

#### üí≥ –ü–ª–∞—Ç–µ–∂–∏ (`/payments`)
| –ú–µ—Ç–æ–¥ | –≠–Ω–¥–ø–æ–∏–Ω—Ç                                | –û–ø–∏—Å–∞–Ω–∏–µ                          |
|-------|-----------------------------------------|-----------------------------------|
| POST  | `/payments/paycash?tg_id=&amount=`      | –ü–æ–ø–æ–ª–Ω–∏—Ç—å –±–∞–ª–∞–Ω—Å                  |
| POST  | `/payments/callback`                    | Callback –æ—Ç –ø–ª–∞—Ç–µ–∂–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã     |
| GET   | `/payments/transactions/{tg_id}`        | –ò—Å—Ç–æ—Ä–∏—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –∏–≥—Ä–æ–∫–∞         |

---

### üîÑ Real-Time (Centrifugo)

–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è **Centrifugo** –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏.

**–°–æ–±—ã—Ç–∏—è:**
- `new_room` ‚Äî —Å–æ–∑–¥–∞–Ω–∞ –Ω–æ–≤–∞—è –∫–æ–º–Ω–∞—Ç–∞  
- `close_room` ‚Äî –∫–æ–º–Ω–∞—Ç–∞ –∑–∞–∫—Ä—ã—Ç–∞  
- `game_start` ‚Äî –Ω–∞—á–∞–ª–æ –∏–≥—Ä—ã  
- `move` ‚Äî —Å–¥–µ–ª–∞–Ω —Ö–æ–¥  
- `hand` ‚Äî –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–∞—Ä—Ç –∏–≥—Ä–æ–∫–∞  
  ```json
  {
    "event": "hand",
    "payload": {
      "hand": [["8","‚ô•"],["J","‚ô£"],["9","‚ô†"]],
      "old_cards_user": [["6","‚ô†"]],
      "trump": "‚ô¶",
      "deck_count": 28,
      "attacker": "7022782558"
    }
  }


game_over ‚Äî –∏–≥—Ä–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞

reshuffle ‚Äî –ø–µ—Ä–µ—Å–¥–∞—á–∞ –∫–∞—Ä—Ç


### üîó –ò–≥—Ä–æ–≤–æ–π –ø—Ä–æ—Ü–µ—Å—Å
–ò–≥—Ä–æ–∫ –≤—ã–∑—ã–≤–∞–µ—Ç find_player –∏–ª–∏ join_room.

–ü—Ä–∏ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ –∂–º–µ—Ç ready.

–ü–æ—Å–ª–µ —Å—Ç–∞—Ä—Ç–∞ –ø–æ–ª—É—á–∞–µ—Ç —Å–æ–±—ã—Ç–∏–µ game_start –∏ —Å–≤–æ—é —Ä—É–∫—É (hand).

–ò–≥—Ä–æ–∫–∏ —Ö–æ–¥—è—Ç —á–µ—Ä–µ–∑ move, —Å–æ–±—ã—Ç–∏—è –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è —á–µ—Ä–µ–∑ Centrifugo.

–ü—Ä–∏ –¥–æ–±–æ—Ä–µ –∫–∞—Ä—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è hand —Å new_cards –∏ old_cards_user.

–ò–≥—Ä–∞ –∑–∞–≤–µ—Ä—à–∞–µ—Ç—Å—è —Å–æ–±—ã—Ç–∏–µ–º game_over –ª–∏–±–æ –ø–µ—Ä–µ—Å–¥–∞—á–µ–π reshuffle.