# üéÆ Burkozel Online API ‚Äî Frontend Guide

–≠—Ç–æ—Ç –¥–æ–∫—É–º–µ–Ω—Ç –æ–ø–∏—Å—ã–≤–∞–µ—Ç REST API –∏ —Å–æ–±—ã—Ç–∏—è **Centrifugo**, –∫–æ—Ç–æ—Ä—ã–µ —Ñ—Ä–æ–Ω—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –¥–ª—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –∏–≥—Ä—ã **–ë—É—Ä–∫–æ–∑—ë–ª 1x1**.

---

## üìå –û–±—â–∏–µ –ø–æ–ª–æ–∂–µ–Ω–∏—è

* **–ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –∏–≥—Ä–æ–∫–æ–≤** ‚Äî —á–µ—Ä–µ–∑ `tg_id` (Telegram ID).
* **REST API** ‚Äî –≤—Å–µ –∏–≥—Ä–æ–≤—ã–µ –¥–µ–π—Å—Ç–≤–∏—è (`/burkozel/...`).
* **Centrifugo** ‚Äî WebSocket-–∫–∞–Ω–∞–ª—ã –¥–ª—è —Å–æ–±—ã—Ç–∏–π –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏.
* **Redis** ‚Äî —Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –∫–æ–º–Ω–∞—Ç—ã: –∫–æ–ª–æ–¥–∞, –ø–æ–ª–µ, –∏–≥—Ä–æ–∫–∏, –æ—á–∫–∏.

---

## üîó REST API

### `POST /burkozel/find_player`

–ü–æ–∏—Å–∫ –∫–æ–º–Ω–∞—Ç—ã –∏–ª–∏ —Å–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–π.

**Request**

```json
{
  "tg_id": 7022782558,
  "nickname": "sasha",
  "stake": 10
}
```

**Response (–Ω–∞—à—ë–ª—Å—è —Å–æ–ø–µ—Ä–Ω–∏–∫)**

```json
{
  "room_id": "10_a42fe7db",
  "status": "matched",
  "message": "–ò–≥—Ä–æ–∫ –Ω–∞–π–¥–µ–Ω",
  "stake": 10,
  "opponent": "edward"
}
```

**Response (–æ–∂–∏–¥–∞–µ–º —Å–æ–ø–µ—Ä–Ω–∏–∫–∞)**

```json
{
  "room_id": "10_123abcd4",
  "status": "waiting",
  "message": "–û–∂–∏–¥–∞–Ω–∏–µ –≤—Ç–æ—Ä–æ–≥–æ –∏–≥—Ä–æ–∫–∞",
  "stake": 10
}
```

---

### `POST /burkozel/ready`

–ò–≥—Ä–æ–∫ –æ—Ç–º–µ—á–∞–µ—Ç –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç—å. –ö–æ–≥–¥–∞ –æ–±–∞ –≥–æ—Ç–æ–≤—ã ‚Üí —Å—Ç–∞—Ä—Ç –∏–≥—Ä—ã.

**Request**

```json
{
  "room_id": "10_a42fe7db",
  "tg_id": 7022782558
}
```

**Response**

```json
{ "ok": true }
```

–ü–æ—Å–ª–µ —Å—Ç–∞—Ä—Ç–∞ –≤—Å–µ–º –∏–≥—Ä–æ–∫–∞–º –ø—Ä–∏—Ö–æ–¥—è—Ç —Å–æ–±—ã—Ç–∏—è –≤ Centrifugo:

* `hand` (–∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω–æ, –∫–∞—Ä—Ç—ã –∏–≥—Ä–æ–∫–∞),
* `game_start` (–æ–±—â–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è: –∫–æ–∑—ã—Ä—å, –∞—Ç–∞–∫—É—é—â–∏–π, –∫–æ–ª–æ–¥–∞).

---

### `POST /burkozel/move`

–ò–≥—Ä–æ–∫ –¥–µ–ª–∞–µ—Ç —Ö–æ–¥.

* –ï—Å–ª–∏ –ø–æ–ª–µ –ø—É—Å—Ç–æ–µ ‚Üí **–∞—Ç–∞–∫–∞**.
* –ï—Å–ª–∏ –ø–æ–ª–µ —É–∂–µ –∑–∞–ø–æ–ª–Ω–µ–Ω–æ –∞—Ç–∞–∫–æ–π ‚Üí **–∑–∞—â–∏—Ç–∞**.
* –ü–æ—Å–ª–µ –∑–∞—â–∏—Ç—ã ‚Üí –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è –ø–æ–±–µ–¥–∏—Ç–µ–ª—å, –Ω–∞—á–∏—Å–ª—è—é—Ç—Å—è –æ—á–∫–∏, –¥–æ–±–æ—Ä –∫–∞—Ä—Ç –ø–æ –æ–¥–Ω–æ–π (–¥–æ 4 –≤ —Ä—É–∫–µ), –ø–æ–ª–µ –æ—á–∏—â–∞–µ—Ç—Å—è.

**Request**

```json
{
  "room_id": "10_a42fe7db",
  "tg_id": 7022782558,
  "cards": [["8","‚ô†"]]
}
```

**Response**

```json
{
  "ok": true,
  "room": { ...–ø–æ–ª–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∫–æ–º–Ω–∞—Ç—ã... }
}
```


---

### `GET /burkozel/rooms`

–ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –∞–∫—Ç–∏–≤–Ω—ã—Ö –∫–æ–º–Ω–∞—Ç.

---

### `POST /burkozel/clear_room/{room_id}`

–£–¥–∞–ª–∏—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—É—é –∫–æ–º–Ω–∞—Ç—É (–¥–ª—è –∞–¥–º–∏–Ω–æ–≤/–æ—Ç–ª–∞–¥–∫–∏).

---

### `POST /burkozel/create_test_room`

–°–æ–∑–¥–∞—Ç—å —Ç–µ—Å—Ç–æ–≤—É—é –∫–æ–º–Ω–∞—Ç—É (—Å –ø–æ–ª–Ω–æ–π –∫–æ–ª–æ–¥–æ–π –∏ —Ä—É–∫–∞–º–∏ –ø–æ 4 –∫–∞—Ä—Ç—ã).
–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏ —Ñ—Ä–æ–Ω—Ç–∞.

---

## üì° Centrifugo Events

### üîπ –ò–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–µ –∫–∞–Ω–∞–ª—ã

–ö–∞–Ω–∞–ª: `user#{tg_id}`

#### `hand`

–û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ –∏ –ø—Ä–∏ –¥–æ–±–æ—Ä–µ –∫–∞—Ä—Ç.

```json
{
  "event": "hand",
  "payload": {
    "hand": [["8","‚ô•"],["J","‚ô£"],["9","‚ô†"],["8","‚ô†"]],
    "trump": "‚ô¶",
    "deck_count": 28,
    "attacker": "7022782558"
  }
}
```

---

### üîπ –ö–∞–Ω–∞–ª –∫–æ–º–Ω–∞—Ç—ã

–ö–∞–Ω–∞–ª: `room#{room_id}`

#### `game_start`

```json
{
  "event": "game_start",
  "payload": {
    "room_id": "10_a42fe7db",
    "trump": "‚ô•",
    "deck_count": 28,
    "attacker": "7022782558"
  }
}
```

#### `move`

```json
{
  "event": "move",
  "payload": {
    "room_id": "10_a42fe7db",
    "field": {
      "attack": {"player": "7022782558", "cards": [["8","‚ô†"]]},
      "defend": {"player": "5254325840", "cards": [["9","‚ô†"]]},
      "winner": "5254325840"
    },
    "hands_count": {
      "7022782558": 4,
      "5254325840": 4
    }
  }
}
```

#### `game_over`

```json
{
  "event": "game_over",
  "payload": {
    "room_id": "10_a42fe7db",
    "winner": "7022782558",
    "loser": "5254325840",
    "stake": 10
  }
}
```

---

# üì¶ –•—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –≤ Redis

–ö–∞–∂–¥–∞—è –∫–æ–º–Ω–∞—Ç–∞ —Ö—Ä–∞–Ω–∏—Ç—Å—è –∫–∞–∫ –æ–¥–∏–Ω –∫–ª—é—á –≤ Redis:

üîë **–ö–ª—é—á**:

```
{stake}_{room_id}
–Ω–∞–ø—Ä–∏–º–µ—Ä: "10_a42fe7db"
```

üìÑ **–ó–Ω–∞—á–µ–Ω–∏–µ (JSON):**

```json
{
  "room_id": "10_a42fe7db",
  "stake": 10,
  "created_at": "2025-09-12T07:39:26.642840",
  "status": "playing",
  "players": {
    "7022782558": {
      "nickname": "sasha",
      "is_ready": true,
      "hand": [
        ["8","‚ô•"], ["J","‚ô£"], ["9","‚ô†"], ["8","‚ô†"]
      ],
      "round_score": 0,
      "penalty": 0
    },
    "5254325840": {
      "nickname": "ed",
      "is_ready": true,
      "hand": [
        ["A","‚ô£"], ["7","‚ô¶"], ["Q","‚ô†"], ["8","‚ô¶"]
      ],
      "round_score": 0,
      "penalty": 0
    }
  },
  "deck": [
    ["Q","‚ô¶"], ["9","‚ô•"], ["8","‚ô£"], ["A","‚ô¶"], ...
  ],
  "trump": "‚ô•",
  "field": {
    "attack": null,
    "defend": null,
    "winner": null
  },
  "attacker": "7022782558"
}
```

---

### üîë –û—Å–Ω–æ–≤–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã

* `room_id` ‚Äî —É–Ω–∏–∫–∞–ª—å–Ω—ã–π ID –∫–æ–º–Ω–∞—Ç—ã (stake + random uuid).
* `stake` ‚Äî —Å—Ç–∞–≤–∫–∞ (—Ä–∞–∑–º–µ—Ä –±–∞–Ω–∫–∞).
* `status` ‚Äî `waiting` | `matched` | `playing`.
* `players` ‚Äî –∏–≥—Ä–æ–∫–∏ –≤ –∫–æ–º–Ω–∞—Ç–µ:

  * `nickname` ‚Äî –∏–º—è –∏–≥—Ä–æ–∫–∞.
  * `hand` ‚Äî —Å–ø–∏—Å–æ–∫ –∫–∞—Ä—Ç –Ω–∞ —Ä—É–∫–∞—Ö.
  * `round_score` ‚Äî –æ—á–∫–∏ –∑–∞ –≤–∑—è—Ç–∫–∏ –≤ —Ç–µ–∫—É—â–µ–π –ø–∞—Ä—Ç–∏–∏.
  * `penalty` ‚Äî —à—Ç—Ä–∞—Ñ–Ω—ã–µ –æ—á–∫–∏ (–¥–æ 12).
* `deck` ‚Äî –æ—Å—Ç–∞–≤—à–∏–µ—Å—è –∫–∞—Ä—Ç—ã –≤ –∫–æ–ª–æ–¥–µ.
* `trump` ‚Äî –∫–æ–∑—ã—Ä–Ω–∞—è –º–∞—Å—Ç—å.
* `field` ‚Äî —Ç–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Å—Ç–æ–ª–∞:

  * `attack` ‚Äî –∫–∞—Ä—Ç—ã –∞—Ç–∞–∫—É—é—â–µ–≥–æ.
  * `defend` ‚Äî –∫–∞—Ä—Ç—ã –∑–∞—â–∏—Ç–Ω–∏–∫–∞.
  * `winner` ‚Äî ID –∏–≥—Ä–æ–∫–∞, –∫–æ—Ç–æ—Ä—ã–π –≤–∑—è–ª –≤–∑—è—Ç–∫—É (null, –ø–æ–∫–∞ –Ω–µ –æ–ø—Ä–µ–¥–µ–ª—ë–Ω).
* `attacker` ‚Äî —á–µ–π —Å–µ–π—á–∞—Å —Ö–æ–¥.

---

# üß™ –≠–Ω–¥–ø–æ–∏–Ω—Ç: —Å–æ–∑–¥–∞–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤–æ–π –∫–æ–º–Ω–∞—Ç—ã

–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏ —Ñ—Ä–æ–Ω—Ç–∞: –±—ã—Å—Ç—Ä–æ —Å–æ–∑–¥–∞—Ç—å –≥–æ—Ç–æ–≤—É—é –∫–æ–º–Ω–∞—Ç—É —Å –ø—Ä–µ–¥–æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã–º–∏ —Ä—É–∫–∞–º–∏ –∏ –∫–æ–ª–æ–¥–æ–π.

```python
@router.post("/create_test_room")
async def create_test_room(redis: CustomRedis = Depends(get_redis)):
    room_id = f"10_{uuid.uuid4().hex[:8]}"
    trump = "‚ô•"

    room = {
        "room_id": room_id,
        "stake": 10,
        "created_at": datetime.utcnow().isoformat(),
        "status": "playing",
        "players": {
            "7022782558": {
                "nickname": "sasha",
                "is_ready": True,
                "hand": [["8","‚ô•"],["J","‚ô£"],["9","‚ô†"],["8","‚ô†"]],
                "round_score": 0,
                "penalty": 0
            },
            "5254325840": {
                "nickname": "ed",
                "is_ready": True,
                "hand": [["A","‚ô£"],["7","‚ô¶"],["Q","‚ô†"],["8","‚ô¶"]],
                "round_score": 0,
                "penalty": 0
            }
        },
        "deck": [
            ["Q","‚ô¶"], ["9","‚ô•"], ["8","‚ô£"], ["A","‚ô¶"], ["9","‚ô¶"], ["Q","‚ô•"],
            ["A","‚ô•"], ["6","‚ô•"], ["10","‚ô†"], ["10","‚ô¶"], ["K","‚ô¶"], ["K","‚ô£"],
            ["6","‚ô£"], ["A","‚ô†"], ["J","‚ô†"], ["7","‚ô£"], ["J","‚ô•"], ["6","‚ô¶"],
            ["7","‚ô†"], ["7","‚ô•"], ["K","‚ô†"], ["9","‚ô£"], ["Q","‚ô£"], ["6","‚ô†"],
            ["10","‚ô£"], ["K","‚ô•"], ["J","‚ô¶"]
        ],
        "trump": trump,
        "field": {"attack": None, "defend": None, "winner": None},
        "attacker": "7022782558"
    }

    await redis.set(room_id, json.dumps(room))
    logger.info(f"[TEST] –°–æ–∑–¥–∞–Ω–∞ —Ç–µ—Å—Ç–æ–≤–∞—è –∫–æ–º–Ω–∞—Ç–∞ {room_id}")

    return {"ok": True, "room": room}
```

---

–•–æ—Ä–æ—à–æ üöÄ
–î–∞–≤–∞–π –ø–æ—à–∞–≥–æ–≤–æ —Ä–∞–∑–±–µ—Ä—ë–º, –∫–∞–∫ –ø–æ–¥–Ω—è—Ç—å —Ç–≤–æ–π –ø—Ä–æ–µ–∫—Ç —á–µ—Ä–µ–∑ **Docker** –∏ **docker-compose**.

---

# üì¶ –ü–æ–¥–Ω—è—Ç–∏–µ –ø—Ä–æ–µ–∫—Ç–∞ —á–µ—Ä–µ–∑ Docker


## ‚öôÔ∏è –§–∞–π–ª `.env`

–ü—Ä–∏–º–µ—Ä `.env` –¥–ª—è dev:

```env
POSTGRES_USER=postgres
POSTGRES_PASSWORD=postgres
POSTGRES_DB=burkozel
POSTGRES_HOST=db
POSTGRES_PORT=5432

REDIS_HOST=redis
REDIS_PORT=6379
REDIS_PASSWORD= # –µ—Å–ª–∏ –±–µ–∑ –ø–∞—Ä–æ–ª—è, –æ—Å—Ç–∞–≤–∏—Ç—å –ø—É—Å—Ç—ã–º

CENTRIFUGO_API_KEY=super_api_key
CENTRIFUGO_URL=http://centrifugo:8000/api
SOCKET_URL=ws://localhost:8000/connection/websocket

DB_URL=postgresql+asyncpg://postgres:postgres@db:5432/burkozel
```

## üöÄ –ó–∞–ø—É—Å–∫

```bash
# –°–±–æ—Ä–∫–∞
docker-compose build

# –ó–∞–ø—É—Å–∫
docker-compose up -d

```

---

## 7. üîó –î–æ—Å—Ç—É–ø

* FastAPI backend ‚Üí [http://localhost:8001/docs](http://localhost:8001/docs)
* Centrifugo ‚Üí [http://localhost:8000](http://localhost:8000)
* Redis ‚Üí localhost:6379
* Postgres ‚Üí localhost:5432

---
